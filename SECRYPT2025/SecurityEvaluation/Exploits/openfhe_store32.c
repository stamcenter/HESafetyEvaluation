#include <stdint.h>
#include <string.h>
#include <stdio.h>


int blake2b_final(blake2b_state *S, void *out, size_t outlen) {
  uint8_t buffer[BLAKE2B_OUTBYTES] = {0};
  size_t i;

  if (out == NULL || outlen < S->outlen) return -1;

  if (blake2b_is_lastblock(S)) return -1;

  blake2b_increment_counter(S, S->buflen);
  blake2b_set_lastblock(S);
  memset(S->buf + S->buflen, 0, BLAKE2B_BLOCKBYTES - S->buflen); /* Padding */
  blake2b_compress(S, S->buf);

  for (i = 0; i < 8; ++i) /* Output full hash to temp buffer */
    store64(buffer + sizeof(S->h[i]) * i, S->h[i]);

  memcpy(out, buffer, S->outlen);
  secure_zero_memory(buffer, sizeof(buffer));
  return 0;
}

void store64(void *dst, uint64_t w) {
  #if defined(NATIVE_LITTLE_ENDIAN)
    memcpy(dst, &w, sizeof w);
  #else
    uint8_t *p = (uint8_t *)dst;
    p[0] = (uint8_t)(w >> 0);
    p[1] = (uint8_t)(w >> 8);
    p[2] = (uint8_t)(w >> 16);
    p[3] = (uint8_t)(w >> 24);
    p[4] = (uint8_t)(w >> 32);
    p[5] = (uint8_t)(w >> 40);
    p[6] = (uint8_t)(w >> 48);
    p[7] = (uint8_t)(w >> 56);
  #endif
}

int main(int argc, char *argv[]){
  uint64_t a = 400;
  uint8_t desti[64]; 
  store64(&desti[0], a);

  printf("The value of a: %ld \n", a);
  printf("Stored values: %u %u \n", desti[0], desti[1]);
  return 0;
}

